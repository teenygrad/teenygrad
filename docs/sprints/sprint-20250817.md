# Week ending - 17/Aug/2025

## Sprint Goal

Compile a basic pytorch model to PTX and return a compiled module to pytorch.

### Tasks

1. Capture MLIR generated for a basic model by pytorch.
2. Using the example lower the e-graph to the same MLIR.
3. Compile the MLIR to binary.
4. Return compiled module to pytorch.

### Tech debt

- Shape tracked has been removed during this sprint, to take a step back and design a better shape tracking system.
- The API is not very ergonomic at the moment, will need to revisit once the whole thing works and I have a clearer idea of what the right traits and tructs are.
- Modify project to use error_stack as that is more ergonomic as it has good compatibility with thiserror and provides stack traces. With anyhow we lose the error type because it used a dyn.
- Moving to mixed precision has meant that there is less compile time safety. This needs to be revisited to see how we can gain leverage Rust for a more type safe graph API.

### Sprint Review

- Good
  - Able to use pytorch to compile hugging face qwen3 and export fxgraphs for analysis.
  - Have a good handle on how torch dynamo works under the hood and how the compiler  integrates into it, including graph breaks.
  - Have a good handle egraph and equality saturation.
  - Had really long train journey (8 hours in total), so caught up on some the GPU mode talks I had been meaning to watch.

- Bad
  - Slow progress on FX graph to MLIR, egraph approach was unplanned but the best solution for the moment.
  - The graph generated from qwen3 compilation is a bit random, interpersing torch specific functions/method as well as more general tensor operations. Which is good in some ways as it allows for more scope to optimize, but means that the egraphs generated will have nodes that are torch specific. I had hoped it might be a more general IR, that I could use with Onnx (i.e, tranform onnx to this IR, and use the existing compiler infra)

- Ugly
  - Will need to implement kernels for Torch specific operations as well as the more general tensor operations.
